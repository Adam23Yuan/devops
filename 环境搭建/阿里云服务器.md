### 阿里云 安全组与防火墙的流量路径示意图

##### 说明

### 图解说明

1. **外部客户端 → 安全组**
   - 若安全组没开放端口，直接被云端丢弃。
   - 若安全组放行 → 继续进入 ECS。
2. **系统防火墙（firewalld/iptables）**
   - 若防火墙没开放端口 → 系统拒绝连接。
   - 若防火墙放行 → 到达应用层。
3. **应用监听端口**
   - 程序监听成功，访问正常返回。

###  最终结果判断

✅ **安全组通过 + 防火墙通过 + 应用监听**
 → 外部访问成功
 ❌ 任一环节失败
 → 请求被拦截

```mermaid
graph TD
    A[外部客户端] --> B[阿里云安全组]
    B --> C[ECS 实例网卡]
    C --> D[系统防火墙]
    D --> E[应用监听端口]

    %% 说明路径
    B -. 若未放行 .-> X[请求被云端拦截]
    D -. 若未放行 .-> Y[请求被主机拦截]

```

```mermaid
graph TD
    A[外部客户端] --> B{安全组是否放行?}
    B -->|否| X[请求被云端拦截]
    B -->|是| C{系统防火墙是否放行?}
    C -->|否| Y[请求被主机拦截]
    C -->|是| D[应用监听端口]
    D --> E[请求成功到达应用]

```

### 阿里云网络资源图谱

```mermaid
graph TD

%% ========== 资源组 ==========
subgraph RG["资源组 Resource Group"]
    %% ========== VPC ==========
    subgraph VPC["专有网络 VPC (10.0.0.0/16)"]
        direction TB

        %% 路由表
        RT["路由表 Route Table"]
        
        %% ========== 交换机 A ==========
        subgraph VSwitchA["交换机 vSwitch A (10.0.1.0/24)"]
            direction TB
            ENI1["网卡 ENI-1\n主私网IP: 10.0.1.5"]
            ENI2["网卡 ENI-2\n主私网IP: 10.0.1.6"]
            ECS1["ECS 实例 A"]
            ECS2["ECS 实例 B"]
            ECS1 --> ENI1
            ECS2 --> ENI2
        end

        %% ========== 交换机 B ==========
        subgraph VSwitchB["交换机 vSwitch B (10.0.2.0/24)"]
            direction TB
            ENI3["网卡 ENI-3\n主私网IP: 10.0.2.5"]
            ECS3["ECS 实例 C"]
            ECS3 --> ENI3
        end

        %% VSwitch 与路由表关联
        RT --> VSwitchA
        RT --> VSwitchB

        %% 同一 VPC 的 vSwitch 默认互通
        VSwitchA --- VSwitchB
    end

    %% ========== EIP ==========
    subgraph EIP["弹性公网IP池"]
        IP1["EIP-1\n47.x.x.x"]
    end

    %% 绑定关系
    ECS1 --> IP1
end

```

##### 弹性公网IP 绑定关系说明图谱

```mermaid
graph LR
    %% 定义杭州地域
    subgraph CN_HZ["华东1（杭州）"]
        EIP1["EIP（杭州）"]
        ECS1["ECS（杭州A区）"]
        EIP1 --> ECS1
    end

    %% 定义北京地域
    subgraph CN_BJ["华北2（北京）"]
        EIP2["EIP（北京）"]
        ECS2["ECS（北京C区）"]
        EIP2 --> ECS2
    end

    %% 说明跨地域不支持
    EIP1 -. 无法绑定 .-> ECS2
    EIP2 -. 无法绑定 .-> ECS1

    %% 添加注释节点
    Note["❌ 跨地域绑定不支持"]
    EIP1 --- Note
    EIP2 --- Note

```

```mermaid
graph LR
    subgraph VPC["专有网络 VPC"]
        NAT["NAT 网关（绑定EIP）"]
        ECS1["ECS1：Redis"]
        ECS2["ECS2：MySQL"]
        NAT --> ECS1
        NAT --> ECS2
    end
    EIP["弹性公网IP（唯一公网入口）"] --> NAT
    Client["外部客户端"] --> EIP

```

##### 公网网关" 和 "VPC 网关

```mermaid
graph TD
    subgraph Internet["🌍 公网"]
        Client["客户端"]
    end

    subgraph VPC["🏠 专有网络 (VPC)"]
        VRouter["VPC 网关（VRouter）"]
        subgraph Subnet1["子网A（交换机）"]
            ECS1["ECS1"]
        end
        subgraph Subnet2["子网B（交换机）"]
            ECS2["ECS2"]
        end
    end

    NATGW["🌐 公网网关（NAT Gateway）"]
    EIP["EIP（弹性公网IP）"]

    %% 内部连接
    ECS1 --> VRouter
    ECS2 --> VRouter
    VRouter --> NATGW

    %% 公网出入口
    NATGW --> EIP --> Client

    %% 说明
    classDef note fill:#f9f9f9,stroke:#ccc,stroke-width:1px,color:#333;
    Note1["VRouter：VPC 的内部路由核心，管理子网间通信"]:::note
    Note2["NAT 网关：负责公网访问和端口映射"]:::note

    Note1 -.-> VRouter
    Note2 -.-> NATGW

```

##### SSL VPN 网关接入 VPC

```mermaid
graph TD
    subgraph Local["🏠 本地电脑"]
        VPNClient["SSL VPN 客户端"]
    end

    subgraph Internet["🌍 公网"]
    end

    subgraph VPC["🏢 阿里云 VPC"]
        VPNGW["VPN 网关（SSL模式）"]
        Redis["Redis 实例（仅VPC内访问）"]
    end

    VPNClient -->|SSL加密通道| VPNGW
    VPNGW --> Redis

```

##### 挂载云盘 手动操作 

```bash
## 非核心服务器
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# mkdir -p /mnt/vdb1
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# mount /dev/vdb1 /mnt/vdb1
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# df -h
文件系统        容量  已用  可用 已用% 挂载点
devtmpfs         16G     0   16G    0% /dev
tmpfs            16G     0   16G    0% /dev/shm
tmpfs            16G  576K   16G    1% /run
tmpfs            16G     0   16G    0% /sys/fs/cgroup
/dev/vda1        99G  6.9G   88G    8% /
tmpfs           3.1G     0  3.1G    0% /run/user/0
/dev/vdb1       493G   73M  467G    1% /mnt/vdb1
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# blkid /dev/vdb1
/dev/vdb1: UUID="03c448bd-1c38-47eb-98dd-b855c92eb46d" TYPE="ext4" PARTLABEL="Linux" PARTUUID="cf33f9bd-3891-4aea-a627-1a3a95397ce6" 
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# vi /etc/fstab
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# vi /etc/fstab
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# cat /etc/fastab
cat: /etc/fastab: 没有那个文件或目录
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Fri Jun 28 04:16:23 2024
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=c8b5b2da-5565-4dc1-b002-2a8b07573e22 /                       ext4    defaults        1 1
UUID=03c448bd-1c38-47eb-98dd-b855c92eb46d /mnt/vdb1 ext4 defaults,nofail 0 2


## 中间件服务器
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# mkdir -p /mnt/vdb1
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# mount /dev/vdb1 /mnt/vdb1
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# df -h
文件系统        容量  已用  可用 已用% 挂载点
devtmpfs         16G     0   16G    0% /dev
tmpfs            16G     0   16G    0% /dev/shm
tmpfs            16G  580K   16G    1% /run
tmpfs            16G     0   16G    0% /sys/fs/cgroup
/dev/vda1        99G  4.1G   91G    5% /
tmpfs           3.1G     0  3.1G    0% /run/user/0
/dev/vdb1       493G   73M  467G    1% /mnt/vdb1
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# blkid /dev/vdb1
/dev/vdb1: UUID="77e32567-3860-42f7-9051-087a4ed4cd61" TYPE="ext4" PARTLABEL="Linux" PARTUUID="f639c9ea-ef2d-477d-9666-c21d2fc99005" 
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# ^C
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# ^C
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# vi /etc/fstab
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Fri Jun 28 04:16:23 2024
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=c8b5b2da-5565-4dc1-b002-2a8b07573e22 /                       ext4    defaults        1 1
UUID=03c448bd-1c38-47eb-98dd-b855c92eb46d /mnt/vdb1 ext4 defaults,nofail 0 2
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# vi /etc/fstab
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# blkid /dev/vdb1
/dev/vdb1: UUID="77e32567-3860-42f7-9051-087a4ed4cd61" TYPE="ext4" PARTLABEL="Linux" PARTUUID="f639c9ea-ef2d-477d-9666-c21d2fc99005" 
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# vi /etc/fstab
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# 
连接断开
连接主机...
连接主机成功
Last login: Mon Oct 20 12:06:15 2025 from 113.132.210.120

Welcome to Alibaba Cloud Elastic Compute Service !

[root@iZ2ze8d2ahedv4d36gi3feZ ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Fri Jun 28 04:16:23 2024
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=c8b5b2da-5565-4dc1-b002-2a8b07573e22 /                       ext4    defaults        1 1
UUID=77e32567-3860-42f7-9051-087a4ed4cd61 /mnt/vdb1 ext4 defaults,nofail 0 2
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# 


```

