### é˜¿é‡Œäº‘ å®‰å…¨ç»„ä¸é˜²ç«å¢™çš„æµé‡è·¯å¾„ç¤ºæ„å›¾

##### è¯´æ˜

### å›¾è§£è¯´æ˜

1. **å¤–éƒ¨å®¢æˆ·ç«¯ â†’ å®‰å…¨ç»„**
   - è‹¥å®‰å…¨ç»„æ²¡å¼€æ”¾ç«¯å£ï¼Œç›´æ¥è¢«äº‘ç«¯ä¸¢å¼ƒã€‚
   - è‹¥å®‰å…¨ç»„æ”¾è¡Œ â†’ ç»§ç»­è¿›å…¥ ECSã€‚
2. **ç³»ç»Ÿé˜²ç«å¢™ï¼ˆfirewalld/iptablesï¼‰**
   - è‹¥é˜²ç«å¢™æ²¡å¼€æ”¾ç«¯å£ â†’ ç³»ç»Ÿæ‹’ç»è¿æ¥ã€‚
   - è‹¥é˜²ç«å¢™æ”¾è¡Œ â†’ åˆ°è¾¾åº”ç”¨å±‚ã€‚
3. **åº”ç”¨ç›‘å¬ç«¯å£**
   - ç¨‹åºç›‘å¬æˆåŠŸï¼Œè®¿é—®æ­£å¸¸è¿”å›ã€‚

###  æœ€ç»ˆç»“æœåˆ¤æ–­

âœ… **å®‰å…¨ç»„é€šè¿‡ + é˜²ç«å¢™é€šè¿‡ + åº”ç”¨ç›‘å¬**
 â†’ å¤–éƒ¨è®¿é—®æˆåŠŸ
 âŒ ä»»ä¸€ç¯èŠ‚å¤±è´¥
 â†’ è¯·æ±‚è¢«æ‹¦æˆª

```mermaid
graph TD
    A[å¤–éƒ¨å®¢æˆ·ç«¯] --> B[é˜¿é‡Œäº‘å®‰å…¨ç»„]
    B --> C[ECS å®ä¾‹ç½‘å¡]
    C --> D[ç³»ç»Ÿé˜²ç«å¢™]
    D --> E[åº”ç”¨ç›‘å¬ç«¯å£]

    %% è¯´æ˜è·¯å¾„
    B -. è‹¥æœªæ”¾è¡Œ .-> X[è¯·æ±‚è¢«äº‘ç«¯æ‹¦æˆª]
    D -. è‹¥æœªæ”¾è¡Œ .-> Y[è¯·æ±‚è¢«ä¸»æœºæ‹¦æˆª]

```

```mermaid
graph TD
    A[å¤–éƒ¨å®¢æˆ·ç«¯] --> B{å®‰å…¨ç»„æ˜¯å¦æ”¾è¡Œ?}
    B -->|å¦| X[è¯·æ±‚è¢«äº‘ç«¯æ‹¦æˆª]
    B -->|æ˜¯| C{ç³»ç»Ÿé˜²ç«å¢™æ˜¯å¦æ”¾è¡Œ?}
    C -->|å¦| Y[è¯·æ±‚è¢«ä¸»æœºæ‹¦æˆª]
    C -->|æ˜¯| D[åº”ç”¨ç›‘å¬ç«¯å£]
    D --> E[è¯·æ±‚æˆåŠŸåˆ°è¾¾åº”ç”¨]

```

### é˜¿é‡Œäº‘ç½‘ç»œèµ„æºå›¾è°±

```mermaid
graph TD

%% ========== èµ„æºç»„ ==========
subgraph RG["èµ„æºç»„ Resource Group"]
    %% ========== VPC ==========
    subgraph VPC["ä¸“æœ‰ç½‘ç»œ VPC (10.0.0.0/16)"]
        direction TB

        %% è·¯ç”±è¡¨
        RT["è·¯ç”±è¡¨ Route Table"]
        
        %% ========== äº¤æ¢æœº A ==========
        subgraph VSwitchA["äº¤æ¢æœº vSwitch A (10.0.1.0/24)"]
            direction TB
            ENI1["ç½‘å¡ ENI-1\nä¸»ç§ç½‘IP: 10.0.1.5"]
            ENI2["ç½‘å¡ ENI-2\nä¸»ç§ç½‘IP: 10.0.1.6"]
            ECS1["ECS å®ä¾‹ A"]
            ECS2["ECS å®ä¾‹ B"]
            ECS1 --> ENI1
            ECS2 --> ENI2
        end

        %% ========== äº¤æ¢æœº B ==========
        subgraph VSwitchB["äº¤æ¢æœº vSwitch B (10.0.2.0/24)"]
            direction TB
            ENI3["ç½‘å¡ ENI-3\nä¸»ç§ç½‘IP: 10.0.2.5"]
            ECS3["ECS å®ä¾‹ C"]
            ECS3 --> ENI3
        end

        %% VSwitch ä¸è·¯ç”±è¡¨å…³è”
        RT --> VSwitchA
        RT --> VSwitchB

        %% åŒä¸€ VPC çš„ vSwitch é»˜è®¤äº’é€š
        VSwitchA --- VSwitchB
    end

    %% ========== EIP ==========
    subgraph EIP["å¼¹æ€§å…¬ç½‘IPæ± "]
        IP1["EIP-1\n47.x.x.x"]
    end

    %% ç»‘å®šå…³ç³»
    ECS1 --> IP1
end

```

##### å¼¹æ€§å…¬ç½‘IP ç»‘å®šå…³ç³»è¯´æ˜å›¾è°±

```mermaid
graph LR
    %% å®šä¹‰æ­å·åœ°åŸŸ
    subgraph CN_HZ["åä¸œ1ï¼ˆæ­å·ï¼‰"]
        EIP1["EIPï¼ˆæ­å·ï¼‰"]
        ECS1["ECSï¼ˆæ­å·AåŒºï¼‰"]
        EIP1 --> ECS1
    end

    %% å®šä¹‰åŒ—äº¬åœ°åŸŸ
    subgraph CN_BJ["ååŒ—2ï¼ˆåŒ—äº¬ï¼‰"]
        EIP2["EIPï¼ˆåŒ—äº¬ï¼‰"]
        ECS2["ECSï¼ˆåŒ—äº¬CåŒºï¼‰"]
        EIP2 --> ECS2
    end

    %% è¯´æ˜è·¨åœ°åŸŸä¸æ”¯æŒ
    EIP1 -. æ— æ³•ç»‘å®š .-> ECS2
    EIP2 -. æ— æ³•ç»‘å®š .-> ECS1

    %% æ·»åŠ æ³¨é‡ŠèŠ‚ç‚¹
    Note["âŒ è·¨åœ°åŸŸç»‘å®šä¸æ”¯æŒ"]
    EIP1 --- Note
    EIP2 --- Note

```

```mermaid
graph LR
    subgraph VPC["ä¸“æœ‰ç½‘ç»œ VPC"]
        NAT["NAT ç½‘å…³ï¼ˆç»‘å®šEIPï¼‰"]
        ECS1["ECS1ï¼šRedis"]
        ECS2["ECS2ï¼šMySQL"]
        NAT --> ECS1
        NAT --> ECS2
    end
    EIP["å¼¹æ€§å…¬ç½‘IPï¼ˆå”¯ä¸€å…¬ç½‘å…¥å£ï¼‰"] --> NAT
    Client["å¤–éƒ¨å®¢æˆ·ç«¯"] --> EIP

```

##### å…¬ç½‘ç½‘å…³" å’Œ "VPC ç½‘å…³

```mermaid
graph TD
    subgraph Internet["ğŸŒ å…¬ç½‘"]
        Client["å®¢æˆ·ç«¯"]
    end

    subgraph VPC["ğŸ  ä¸“æœ‰ç½‘ç»œ (VPC)"]
        VRouter["VPC ç½‘å…³ï¼ˆVRouterï¼‰"]
        subgraph Subnet1["å­ç½‘Aï¼ˆäº¤æ¢æœºï¼‰"]
            ECS1["ECS1"]
        end
        subgraph Subnet2["å­ç½‘Bï¼ˆäº¤æ¢æœºï¼‰"]
            ECS2["ECS2"]
        end
    end

    NATGW["ğŸŒ å…¬ç½‘ç½‘å…³ï¼ˆNAT Gatewayï¼‰"]
    EIP["EIPï¼ˆå¼¹æ€§å…¬ç½‘IPï¼‰"]

    %% å†…éƒ¨è¿æ¥
    ECS1 --> VRouter
    ECS2 --> VRouter
    VRouter --> NATGW

    %% å…¬ç½‘å‡ºå…¥å£
    NATGW --> EIP --> Client

    %% è¯´æ˜
    classDef note fill:#f9f9f9,stroke:#ccc,stroke-width:1px,color:#333;
    Note1["VRouterï¼šVPC çš„å†…éƒ¨è·¯ç”±æ ¸å¿ƒï¼Œç®¡ç†å­ç½‘é—´é€šä¿¡"]:::note
    Note2["NAT ç½‘å…³ï¼šè´Ÿè´£å…¬ç½‘è®¿é—®å’Œç«¯å£æ˜ å°„"]:::note

    Note1 -.-> VRouter
    Note2 -.-> NATGW

```

##### SSL VPN ç½‘å…³æ¥å…¥ VPC

```mermaid
graph TD
    subgraph Local["ğŸ  æœ¬åœ°ç”µè„‘"]
        VPNClient["SSL VPN å®¢æˆ·ç«¯"]
    end

    subgraph Internet["ğŸŒ å…¬ç½‘"]
    end

    subgraph VPC["ğŸ¢ é˜¿é‡Œäº‘ VPC"]
        VPNGW["VPN ç½‘å…³ï¼ˆSSLæ¨¡å¼ï¼‰"]
        Redis["Redis å®ä¾‹ï¼ˆä»…VPCå†…è®¿é—®ï¼‰"]
    end

    VPNClient -->|SSLåŠ å¯†é€šé“| VPNGW
    VPNGW --> Redis

```

##### æŒ‚è½½äº‘ç›˜ æ‰‹åŠ¨æ“ä½œ 

```bash
## éæ ¸å¿ƒæœåŠ¡å™¨
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# mkdir -p /mnt/vdb1
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# mount /dev/vdb1 /mnt/vdb1
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# df -h
æ–‡ä»¶ç³»ç»Ÿ        å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
devtmpfs         16G     0   16G    0% /dev
tmpfs            16G     0   16G    0% /dev/shm
tmpfs            16G  576K   16G    1% /run
tmpfs            16G     0   16G    0% /sys/fs/cgroup
/dev/vda1        99G  6.9G   88G    8% /
tmpfs           3.1G     0  3.1G    0% /run/user/0
/dev/vdb1       493G   73M  467G    1% /mnt/vdb1
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# blkid /dev/vdb1
/dev/vdb1: UUID="03c448bd-1c38-47eb-98dd-b855c92eb46d" TYPE="ext4" PARTLABEL="Linux" PARTUUID="cf33f9bd-3891-4aea-a627-1a3a95397ce6" 
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# vi /etc/fstab
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# vi /etc/fstab
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# cat /etc/fastab
cat: /etc/fastab: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•
[root@iZ2ze8q9293ytn6mlia8fuZ ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Fri Jun 28 04:16:23 2024
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=c8b5b2da-5565-4dc1-b002-2a8b07573e22 /                       ext4    defaults        1 1
UUID=03c448bd-1c38-47eb-98dd-b855c92eb46d /mnt/vdb1 ext4 defaults,nofail 0 2


## ä¸­é—´ä»¶æœåŠ¡å™¨
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# mkdir -p /mnt/vdb1
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# mount /dev/vdb1 /mnt/vdb1
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# df -h
æ–‡ä»¶ç³»ç»Ÿ        å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
devtmpfs         16G     0   16G    0% /dev
tmpfs            16G     0   16G    0% /dev/shm
tmpfs            16G  580K   16G    1% /run
tmpfs            16G     0   16G    0% /sys/fs/cgroup
/dev/vda1        99G  4.1G   91G    5% /
tmpfs           3.1G     0  3.1G    0% /run/user/0
/dev/vdb1       493G   73M  467G    1% /mnt/vdb1
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# blkid /dev/vdb1
/dev/vdb1: UUID="77e32567-3860-42f7-9051-087a4ed4cd61" TYPE="ext4" PARTLABEL="Linux" PARTUUID="f639c9ea-ef2d-477d-9666-c21d2fc99005" 
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# ^C
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# ^C
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# vi /etc/fstab
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Fri Jun 28 04:16:23 2024
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=c8b5b2da-5565-4dc1-b002-2a8b07573e22 /                       ext4    defaults        1 1
UUID=03c448bd-1c38-47eb-98dd-b855c92eb46d /mnt/vdb1 ext4 defaults,nofail 0 2
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# vi /etc/fstab
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# blkid /dev/vdb1
/dev/vdb1: UUID="77e32567-3860-42f7-9051-087a4ed4cd61" TYPE="ext4" PARTLABEL="Linux" PARTUUID="f639c9ea-ef2d-477d-9666-c21d2fc99005" 
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# vi /etc/fstab
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# 
è¿æ¥æ–­å¼€
è¿æ¥ä¸»æœº...
è¿æ¥ä¸»æœºæˆåŠŸ
Last login: Mon Oct 20 12:06:15 2025 from 113.132.210.120

Welcome to Alibaba Cloud Elastic Compute Service !

[root@iZ2ze8d2ahedv4d36gi3feZ ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Fri Jun 28 04:16:23 2024
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=c8b5b2da-5565-4dc1-b002-2a8b07573e22 /                       ext4    defaults        1 1
UUID=77e32567-3860-42f7-9051-087a4ed4cd61 /mnt/vdb1 ext4 defaults,nofail 0 2
[root@iZ2ze8d2ahedv4d36gi3feZ ~]# 


```

